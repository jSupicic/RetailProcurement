<div class="quarterly-plan-container">
  <!-- Header Section -->
  <div class="mb-4">
    <p-card [style]="{'background': 'linear-gradient(135deg, var(--purple-600), var(--purple-800))', 'color': 'white', 'border': 'none'}">
      <div class="flex align-items-center justify-content-between">
        <div>
          <h1 class="text-3xl font-bold m-0 mb-2">
            <i class="pi pi-calendar mr-2"></i>
            Quarterly Plans
          </h1>
          <p class="text-lg m-0 opacity-90">Suppliers for current quarter</p>
        </div>
        <div class="text-right">
          <div class="text-2xl font-bold">{{ suppliers.length }}</div>
          <div class="text-sm opacity-90">Total Plans</div>
          <div class="flex align-items-center justify-content-end mt-2">
            <div class="flex align-items-center gap-2">
              <div 
                class="w-2rem h-2rem border-round flex align-items-center justify-content-center"
                [style]="{
                  'background': connectionStatus === 'Connected' ? '#10b981' : connectionStatus === 'Reconnecting' ? '#f59e0b' : '#ef4444',
                  'color': 'white'
                }"
              >
                <i 
                  [class]="connectionStatus === 'Connected' ? 'pi pi-wifi' : connectionStatus === 'Reconnecting' ? 'pi pi-spin pi-spinner' : 'pi pi-wifi-slash'"
                ></i>
              </div>
              <span class="text-xs opacity-90">
                {{ connectionStatus === 'Connected' ? 'Live Updates' : connectionStatus === 'Reconnecting' ? 'Reconnecting...' : 'Offline' }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Search and Actions Toolbar -->
  <p-toolbar>
    <ng-template pTemplate="left">
      <div class="flex align-items-center gap-2">
        <i class="pi pi-search"></i>
        <input
          type="text"
          pInputText
          placeholder="Search plans..."
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
          class="w-20rem"
        />
      </div>
    </ng-template>
    <ng-template pTemplate="right">
      <p-button
        label="Add New Plan"
        icon="pi pi-plus"
        [style]="{'background': 'var(--purple-600)', 'border': 'none'}"
        class="custom-button"
        (onClick)="openAddModal()"
      />
    </ng-template>
  </p-toolbar>

  <!-- Loading State -->
  <div *ngIf="loading" class="mt-4">
    <p-card>
      <div class="grid">
        <div class="col-12" *ngFor="let i of [1,2,3,4,5]">
          <p-skeleton height="4rem" class="mb-2"></p-skeleton>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Suppliers Table -->
  <div *ngIf="!loading" class="mt-4">
    <p-card class="custom-card">
      <p-table 
        [value]="filteredSuppliers" 
        [paginator]="true" 
        [rows]="10"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} suppliers"
        [rowsPerPageOptions]="[5, 10, 25, 50]"
        [loading]="loading"
        styleClass="custom-datatable"
        [scrollable]="true"
        scrollHeight="400px"
      >
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 3rem">ID</th>
            <th>Name</th>
            <th>Contact Info</th>
            <th>Phone</th>
            <th style="width: 8rem">Actions</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-supplier>
          <tr>
            <td>
              <p-tag [value]="supplier.id" severity="info" [rounded]="true"></p-tag>
            </td>
            <td>
              <div class="flex align-items-center gap-2">
                <i class="pi pi-building text-primary"></i>
                <div>
                  <div class="font-semibold">{{ supplier.name }}</div>
                </div>
              </div>
            </td>
            <td>
              <div class="flex flex-column gap-1">
                <div class="flex align-items-center gap-1">
                  <i class="pi pi-envelope text-sm"></i>
                  <span class="text-sm">{{ supplier.email || 'No email' }}</span>
                </div>
              </div>
            </td>
            <td>
              <div class="flex flex-column gap-1">
                <div class="flex align-items-center gap-1">
                  <i class="pi pi-phone text-sm"></i>
                  <span class="text-sm">{{ supplier.phone || 'No phone' }}</span>
                </div>
              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5" class="text-center py-4">
              <div class="flex flex-column align-items-center gap-3">
                <i class="pi pi-search text-4xl text-400"></i>
                <div class="text-lg text-600">No suppliers found</div>
                <div class="text-sm text-500">Try adjusting your search criteria</div>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>

  <!-- Add/Edit Plan Modal -->
  <p-dialog
    [header]="planId === 0 ? 'Add New Quarterly Plan' : 'Edit Quarterly Plan'"
    [(visible)]="showAddModal"
    [modal]="true"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    [style]="{'width': '600px'}"
    (onHide)="closeAddModal()"
  >
    <form [formGroup]="planForm" (ngSubmit)="onSubmit()" class="plan-form">
      <div class="grid">
        <!-- Year and Quarter -->
        <div class="col-12 md:col-6">
          <div class="field">
            <label for="year" class="block text-sm font-medium mb-2">
              <i class="pi pi-calendar mr-1"></i>
              Year *
            </label>
            <p-dropdown
              id="year"
              formControlName="year"
              [options]="yearOptions"
              placeholder="Select year"
              class="w-full"
              [class.ng-invalid]="planForm.get('year')?.invalid && planForm.get('year')?.touched"
            ></p-dropdown>
            <small
              *ngIf="getFieldError('year')"
              class="text-red-500 text-sm"
            >
              {{ getFieldError('year') }}
            </small>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field">
            <label for="quarter" class="block text-sm font-medium mb-2">
              <i class="pi pi-calendar mr-1"></i>
              Quarter *
            </label>
            <p-dropdown
              id="quarter"
              formControlName="quarter"
              [options]="quarterOptions"
              placeholder="Select quarter"
              class="w-full"
              [class.ng-invalid]="planForm.get('quarter')?.invalid && planForm.get('quarter')?.touched"
            ></p-dropdown>
            <small
              *ngIf="getFieldError('quarter')"
              class="text-red-500 text-sm"
            >
              {{ getFieldError('quarter') }}
            </small>
          </div>
        </div>

        <!-- Supplier IDs -->
        <div class="col-12">
          <div class="field">
            <label for="supplierIds" class="block text-sm font-medium mb-2">
              <i class="pi pi-building mr-1"></i>
              Supplier IDs *
            </label>
            <input
              id="supplierIds"
              type="text"
              pInputText
              formControlName="supplierIds"
              placeholder="1, 2, 3, 4..."
              class="w-full"
              [class.ng-invalid]="planForm.get('supplierIds')?.invalid && planForm.get('supplierIds')?.touched"
            />
            <small class="text-500">Enter comma-separated supplier IDs</small>
            <small
              *ngIf="getFieldError('supplierIds')"
              class="text-red-500 text-sm"
            >
              {{ getFieldError('supplierIds') }}
            </small>
          </div>
        </div>
      </div>
    </form>

    <ng-template pTemplate="footer">
      <div class="flex justify-content-end gap-2">
        <p-button
          label="Cancel"
          icon="pi pi-times"
          [text]="true"
          (onClick)="closeAddModal()"
          [disabled]="submitting"
        />
        <p-button
          [label]="planId === 0 ? 'Add Plan' : 'Update Plan'"
          icon="pi pi-check"
          (onClick)="onSubmit()"
          [loading]="submitting"
          [disabled]="planForm.invalid"
        />
      </div>
    </ng-template>
  </p-dialog>

  <!-- Toast Messages -->
  <p-toast></p-toast>
</div>
