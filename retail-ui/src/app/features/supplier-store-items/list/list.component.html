<div class="store-items-suppliers-container">
  <!-- Header Section -->
  <div class="mb-4">
    <p-card [style]="{'background': 'linear-gradient(135deg, var(--teal-600), var(--teal-800))', 'color': 'white', 'border': 'none'}">
      <div class="flex align-items-center justify-content-between">
        <div>
          <h1 class="text-3xl font-bold m-0 mb-2">
            <i class="pi pi-link mr-2"></i>
            Store Items & Suppliers
          </h1>
          <p class="text-lg m-0 opacity-90">Manage supplier-store item relationships</p>
        </div>
        <div class="text-right">
          <div class="text-2xl font-bold">{{ filteredItems.length }}</div>
          <div class="text-sm opacity-90">Total Relationships</div>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Search and Actions Toolbar -->
  <p-toolbar>
    <ng-template pTemplate="left">
      <div class="flex align-items-center gap-2">
        <i class="pi pi-search"></i>
        <input
          type="text"
          pInputText
          placeholder="Search relationships..."
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
          class="w-20rem"
        />
      </div>
    </ng-template>
    <ng-template pTemplate="right">
      <p-button
        label="Add New Relationship"
        icon="pi pi-plus"
        [style]="{'background': 'var(--teal-600)', 'border': 'none'}"
        class="custom-button"
        (onClick)="openAddModal()"
      />
    </ng-template>
  </p-toolbar>

  <!-- Loading State -->
  <div *ngIf="loading" class="mt-4">
    <p-card>
      <div class="grid">
        <div class="col-12" *ngFor="let i of [1,2,3,4,5]">
          <p-skeleton height="4rem" class="mb-2"></p-skeleton>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Items Table -->
  <div *ngIf="!loading" class="mt-4">
    <p-card class="custom-card">
      <p-table
        [value]="filteredItems"
        [paginator]="true"
        [rows]="10"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} relationships"
        [rowsPerPageOptions]="[5, 10, 25, 50]"
        [loading]="loading"
        styleClass="custom-datatable"
        [scrollable]="true"
        scrollHeight="400px"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>Supplier</th>
            <th>Store Item</th>
            <th style="width: 8rem">Price</th>
            <th style="width: 8rem">Actions</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr>
            <td>
              <div class="flex align-items-center gap-2">
                <i class="pi pi-building text-primary"></i>
                <div>
                  <div class="font-semibold">{{ item.supplierName }}</div>
                  <div class="text-sm text-600">ID: {{ item.supplierId }}</div>
                </div>
              </div>
            </td>
            <td>
              <div class="flex align-items-center gap-2">
                <i class="pi pi-shopping-cart text-primary"></i>
                <div>
                  <div class="font-semibold">{{ item.storeItemName }}</div>
                  <div class="text-sm text-600">ID: {{ item.storeItemId }}</div>
                </div>
              </div>
            </td>
            <td>
              <div class="flex align-items-center gap-2">
                <span [ngClass]="'text-' + (item.supplierPrice < 50 ? 'green' : item.supplierPrice < 100 ? 'orange' : 'red')">
                  {{ formatCurrency(item.supplierPrice) }}
                </span>
              </div>
            </td>
            <td>
              <div class="flex gap-2">
                <p-button
                  icon="pi pi-trash"
                  [text]="true"
                  [rounded]="true"
                  severity="danger"
                  pTooltip="Delete Relationship"
                  (onClick)="onDelete(item.supplierId, item.storeItemId)"
                />
              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5" class="text-center py-4">
              <div class="flex flex-column align-items-center gap-3">
                <i class="pi pi-search text-4xl text-400"></i>
                <div class="text-lg text-600">No relationships found</div>
                <div class="text-sm text-500">Try adjusting your search criteria or add a new relationship</div>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>

  <!-- Add/Edit Relationship Modal -->
  <p-dialog
    [header]="itemId === 0 ? 'Add New Relationship' : 'Edit Relationship'"
    [(visible)]="showAddModal"
    [modal]="true"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    [style]="{'width': '600px'}"
    (onHide)="closeAddModal()"
  >
    <form [formGroup]="itemForm" (ngSubmit)="onSubmit()" class="item-form">
      <div class="grid">
        <!-- Supplier ID Field -->
        <div class="col-12">
          <div class="field">
            <label for="supplierId" class="block text-sm font-medium mb-2">
              <i class="pi pi-building mr-1"></i>
              Supplier ID *
            </label>
            <input
              id="supplierId"
              type="number"
              pInputText
              formControlName="supplierId"
              placeholder="Enter supplier ID"
              class="w-full"
              [class.ng-invalid]="itemForm.get('supplierId')?.invalid && itemForm.get('supplierId')?.touched"
            />
            <small
              *ngIf="getFieldError('supplierId')"
              class="text-red-500 text-sm"
            >
              {{ getFieldError('supplierId') }}
            </small>
          </div>
        </div>

        <!-- Store Item ID Field -->
        <div class="col-12">
          <div class="field">
            <label for="storeItemId" class="block text-sm font-medium mb-2">
              <i class="pi pi-shopping-cart mr-1"></i>
              Store Item ID *
            </label>
            <input
              id="storeItemId"
              type="number"
              pInputText
              formControlName="storeItemId"
              placeholder="Enter store item ID"
              class="w-full"
              [class.ng-invalid]="itemForm.get('storeItemId')?.invalid && itemForm.get('storeItemId')?.touched"
            />
            <small
              *ngIf="getFieldError('storeItemId')"
              class="text-red-500 text-sm"
            >
              {{ getFieldError('storeItemId') }}
            </small>
          </div>
        </div>

        <!-- Supplier Price Field -->
        <div class="col-12">
          <div class="field">
            <label for="supplierPrice" class="block text-sm font-medium mb-2">
              <i class="pi pi-dollar mr-1"></i>
              Supplier Price *
            </label>
            <p-inputNumber
              id="supplierPrice"
              formControlName="supplierPrice"
              mode="currency"
              currency="USD"
              locale="en-US"
              placeholder="0.00"
              class="w-full"
              [class.ng-invalid]="itemForm.get('supplierPrice')?.invalid && itemForm.get('supplierPrice')?.touched"
            ></p-inputNumber>
            <small
              *ngIf="getFieldError('supplierPrice')"
              class="text-red-500 text-sm"
            >
              {{ getFieldError('supplierPrice') }}
            </small>
          </div>
        </div>
      </div>
    </form>

    <ng-template pTemplate="footer">
      <div class="flex justify-content-end gap-2">
        <p-button
          label="Cancel"
          icon="pi pi-times"
          [text]="true"
          (onClick)="closeAddModal()"
          [disabled]="submitting"
        />
        <p-button
          [label]="itemId === 0 ? 'Add Relationship' : 'Update Relationship'"
          icon="pi pi-check"
          (onClick)="onSubmit()"
          [loading]="submitting"
          [disabled]="itemForm.invalid"
        />
      </div>
    </ng-template>
  </p-dialog>

  <!-- Toast Messages -->
  <p-toast></p-toast>
</div>
