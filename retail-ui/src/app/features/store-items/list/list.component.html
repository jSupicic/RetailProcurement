<div class="store-items-container">
  <!-- Header Section -->
  <div class="mb-4">
    <p-card [style]="{'background': 'linear-gradient(135deg, var(--primary-color), var(--primary-600))', 'color': 'white', 'border': 'none'}">
      <div class="flex align-items-center justify-content-between">
        <div>
          <h1 class="text-3xl font-bold m-0 mb-2">
            <i class="pi pi-shopping-cart mr-2"></i>
            Store Items
          </h1>
          <p class="text-lg m-0 opacity-90">Manage your retail inventory</p>
        </div>
        <div class="text-right">
          <div class="text-2xl font-bold">{{ filteredItems.length }}</div>
          <div class="text-sm opacity-90">Total Items</div>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Search and Actions Toolbar -->
  <p-toolbar>
    <ng-template pTemplate="left">
      <div class="flex align-items-center gap-2">
        <i class="pi pi-search"></i>
        <input 
          type="text" 
          pInputText 
          placeholder="Search items..." 
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
          class="w-20rem"
        />
      </div>
    </ng-template>
    <ng-template pTemplate="right">
      <p-button 
        label="Add New Item" 
        icon="pi pi-plus" 
        [style]="{'background': 'var(--primary-color)', 'border': 'none'}"
        class="custom-button"
        (onClick)="openAddModal()"
      />
    </ng-template>
  </p-toolbar>

  <!-- Loading State -->
  <div *ngIf="loading" class="mt-4">
    <p-card>
      <div class="grid">
        <div class="col-12" *ngFor="let i of [1,2,3,4,5]">
          <p-skeleton height="4rem" class="mb-2"></p-skeleton>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Items Table -->
  <div *ngIf="!loading" class="mt-4">
    <p-card class="custom-card">
      <p-table 
        [value]="filteredItems" 
        [paginator]="true" 
        [rows]="10"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} items"
        [rowsPerPageOptions]="[5, 10, 25, 50]"
        [loading]="loading"
        styleClass="custom-datatable"
        [scrollable]="true"
        scrollHeight="400px"
      >
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 3rem">ID</th>
            <th>Name</th>
            <th>Description</th>
            <th style="width: 6rem">Stock Quantity</th>
            <th style="width: 8rem">Actions</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr>
            <td>
              <p-tag [value]="item.id" severity="info" [rounded]="true"></p-tag>
            </td>
            <td>
              <div class="font-semibold">{{ item.name }}</div>
            </td>
            <td>
              <div class="text-sm text-600">{{ item.description || 'No description' }}</div>
            </td>
            <td>
              <div class="flex align-items-center gap-2">
                <i class="pi pi-box" [ngClass]="'text-' + (item.stock > 10 ? 'green' : item.stock > 0 ? 'orange' : 'red')"></i>
                <span [ngClass]="'text-' + (item.stock > 10 ? 'green' : item.stock > 0 ? 'orange' : 'red')">
                  {{ item.stockQuantity || 0 }}
                </span>
              </div>
            </td>
            <td>
              <div class="flex gap-2">
                <p-button 
                  icon="pi pi-eye" 
                  [text]="true" 
                  [rounded]="true"
                  [routerLink]="['/store-items', item.id]"
                  pTooltip="View Details"
                />
                <p-button 
                  icon="pi pi-pencil" 
                  [text]="true" 
                  [rounded]="true"
                  severity="warning"
                  pTooltip="Edit Item"
                  (onClick)="openEditModal(item)"
                />
                <p-button 
                  icon="pi pi-trash" 
                  [text]="true" 
                  [rounded]="true"
                  severity="danger"
                  pTooltip="Delete Item"
                  (onClick)="onDelete(item.id)"
                />
              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="7" class="text-center py-4">
              <div class="flex flex-column align-items-center gap-3">
                <i class="pi pi-search text-4xl text-400"></i>
                <div class="text-lg text-600">No items found</div>
                <div class="text-sm text-500">Try adjusting your search criteria</div>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>

  <!-- Add/Edit Store Item Modal -->
  <p-dialog 
    [header]="itemId === 0 ? 'Add New Store Item' : 'Edit Store Item'" 
    [(visible)]="showAddModal" 
    [modal]="true" 
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    [style]="{'width': '600px'}"
    (onHide)="closeAddModal()"
  >
    <form [formGroup]="itemForm" (ngSubmit)="onSubmit()" class="item-form">
      <div class="grid">
        <!-- Name Field -->
        <div class="col-12">
          <div class="field">
            <label for="name" class="block text-sm font-medium mb-2">
              <i class="pi pi-tag mr-1"></i>
              Item Name *
            </label>
            <input 
              id="name"
              type="text" 
              pInputText 
              formControlName="name"
              placeholder="Enter item name"
              class="w-full"
              [class.ng-invalid]="itemForm.get('name')?.invalid && itemForm.get('name')?.touched"
            />
            <small 
              *ngIf="getFieldError('name')" 
              class="text-red-500 text-sm"
            >
              {{ getFieldError('name') }}
            </small>
          </div>
        </div>

        <!-- Description Field -->
        <div class="col-12">
          <div class="field">
            <label for="description" class="block text-sm font-medium mb-2">
              <i class="pi pi-file-text mr-1"></i>
              Description
            </label>
            <textarea 
              id="description"
              pInputTextarea
              formControlName="description"
              placeholder="Enter item description"
              class="w-full"
              rows="3"
            ></textarea>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field">
            <label for="stock" class="block text-sm font-medium mb-2">
              <i class="pi pi-box mr-1"></i>
              Stock Quantity *
            </label>
            <p-inputNumber 
              id="stock"
              formControlName="stockQuantity"
              placeholder="0"
              class="w-full"
              [class.ng-invalid]="itemForm.get('stockQuantity')?.invalid && itemForm.get('stockQuantity')?.touched"
            ></p-inputNumber>
            <small 
              *ngIf="getFieldError('stockQuantity')" 
              class="text-red-500 text-sm"
            >
              {{ getFieldError('stock') }}
            </small>
          </div>
        </div>
      </div>
    </form>

    <ng-template pTemplate="footer">
      <div class="flex justify-content-end gap-2">
        <p-button 
          label="Cancel" 
          icon="pi pi-times" 
          [text]="true"
          (onClick)="closeAddModal()"
          [disabled]="submitting"
        />
        <p-button 
          [label]="itemId === 0 ? 'Add Item' : 'Update Item'" 
          icon="pi pi-check" 
          (onClick)="onSubmit()"
          [loading]="submitting"
          [disabled]="itemForm.invalid"
        />
      </div>
    </ng-template>
  </p-dialog>

  <!-- Toast Messages -->
  <p-toast></p-toast>
</div>
